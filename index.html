<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ViajeSuperNova - AutoPlay</title>
    <script async src="https://www.gstatic.com/admob/js/admob_web_sdk.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; overflow: hidden; font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-area { position: relative; width: 100vw; height: 100vh; max-width: 800px; max-height: 600px; background: #000022; border: 2px solid #333; overflow: hidden; }
        #ship { position: absolute; bottom: 80px; left: 50%; width: 40px; height: 40px; background: #00ff00; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); transform: translateX(-50%); }
        .meteor { position: absolute; width: 35px; height: 35px; background: #ff4500; border-radius: 50%; box-shadow: 0 0 10px #ff4500; }
        #score { position: absolute; top: 20px; left: 20px; color: #fff; font-size: 24px; z-index: 10; }
        #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 30px; text-align: center; display: none; z-index: 20; background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px; }
        .touch-controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; }
        .t-btn { width: 70px; height: 70px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 30px; user-select: none; }
    </style>
</head>
<body>

<div id="game-area">
    <div id="score">Puntos: 0</div>
    <div id="msg">¡CHOQUE!<br>Reiniciando...</div>
    <div id="ship"></div>
    <div class="touch-controls">
        <div class="t-btn" id="left-btn">◀</div>
        <div class="t-btn" id="right-btn">▶</div>
    </div>
</div>

<script>
    const AD_DATA = { appId: 'ca-app-pub-2815339143145958~3548728658', unitId: 'ca-app-pub-2815339143145958/2155755939' };
    if (window.admob) { admob.init({ appId: AD_DATA.appId }); }

    let score = 0, shipX = 50, gameRunning = true, meteors = [];
    const ship = document.getElementById('ship'), scoreText = document.getElementById('score'), msg = document.getElementById('msg');

    function move(dir) { if(!gameRunning) return; shipX += dir; if(shipX<5) shipX=5; if(shipX>95) shipX=95; ship.style.left = shipX + '%'; }
    
    // Controles
    document.addEventListener('keydown', (e) => { if(e.key==="ArrowLeft") move(-8); if(e.key==="ArrowRight") move(8); });
    document.getElementById('left-btn').ontouchstart = (e) => { e.preventDefault(); move(-10); };
    document.getElementById('right-btn').ontouchstart = (e) => { e.preventDefault(); move(10); };

    function createMeteor() {
        if(!gameRunning) return;
        const m = document.createElement('div');
        m.className = 'meteor';
        m.style.left = Math.random() * 90 + '%';
        m.style.top = '-50px';
        document.getElementById('game-area').appendChild(m);
        meteors.push({ el: m, y: -50 });
    }

    function update() {
        if(!gameRunning) return;
        meteors.forEach((m, i) => {
            m.y += 6;
            m.el.style.top = m.y + 'px';
            const sRect = ship.getBoundingClientRect(), mRect = m.el.getBoundingClientRect();
            if(!(mRect.right < sRect.left || mRect.left > sRect.right || mRect.bottom < sRect.top || mRect.top > sRect.bottom)) {
                gameOver();
            }
            if(m.y > window.innerHeight) { m.el.remove(); meteors.splice(i, 1); score++; scoreText.innerText = 'Puntos: ' + score; }
        });
        requestAnimationFrame(update);
    }

    function gameOver() {
        gameRunning = false;
        msg.style.display = 'block';
        
        // Intento de cargar anuncio en silencio para generar datos
        if (window.admob && admob.interstitial) {
            admob.interstitial.load({ adUnitId: AD_DATA.unitId }).catch(() => {});
        }

        setTimeout(() => {
            meteors.forEach(m => m.el.remove());
            meteors = [];
            score = 0;
            scoreText.innerText = 'Puntos: 0';
            shipX = 50;
            ship.style.left = '50%';
            msg.style.display = 'none';
            gameRunning = true;
            update();
        }, 2000);
    }

    setInterval(createMeteor, 1000);
    update();
</script>
</body>
</html>
